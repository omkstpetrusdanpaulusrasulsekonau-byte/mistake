<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabel Transaksi Neon Blue Rupiah</title>
<style>
/* --- STYLING SAMA SEPERTI SEBELUMNYA --- */
body{background:#dfdfe6;font-family:'Segoe UI',sans-serif;color:#fff;display:flex;justify-content:center;align-items:flex-start;padding:40px;}
.container{width:100%;max-width:900px;background:rgba(0,10,30,0.85);border-radius:20px;padding:30px;box-shadow:0 0 40px rgba(129, 126, 237, 0.4), inset 0 0 20px rgba(144, 178, 228, 0.3);}
h2{text-align:center;margin-bottom:25px;color:#4da6ff;text-shadow:0 0 15px rgba(0,150,255,0.5), 0 0 30px rgba(0,100,255,0.7);}
form{display:grid;grid-template-columns: repeat(4,1fr);gap:12px;margin-bottom:25px;}
input, select{background:#0a0a30;border:1px solid #3399ff;border-radius:12px;padding:12px;color:#fff;box-shadow:0 0 10px rgba(50,150,255,0.4);}
button{grid-column: span 0;background: linear-gradient(45deg,#3399ff,#66ccff);border:none;padding:10px;font-weight:bold;border-radius:15px;cursor:pointer;box-shadow:0 0 25px rgba(0,150,255,0.5);transition: all 0.3s ease;}
button:hover{filter:brightness(1.2);box-shadow:0 0 35px rgba(0,200,255,0.7);}
table{width:100%;border-collapse:collapse;margin-bottom:25px;background: rgba(0,10,50,0.5);border-radius:12px;overflow:hidden;}
thead{background:rgba(0,20,70,0.8);}
th,td{padding:14px;text-align:center;border-bottom:1px solid rgba(0,100,255,0.2);}
th{color:#99ccff;text-shadow:0 0 8px rgba(0,150,255,0.4);}
tbody tr:hover{background:rgba(0,150,255,0.05);}
.card{display:flex;justify-content:space-around;background:rgba(171, 224, 35, 0.968);padding:18px;border-radius:15px;font-size:18px;font-weight:bold;color:#090000;box-shadow:0 0 25px rgba(0,150,255,0.4);margin-top:10px;}
.action-btn{background:linear-gradient(45deg,#3399ff,#66ccff);border:none;padding:6px 14px;border-radius:12px;cursor:pointer;margin:2px;color:#fff;transition: all 0.3s ease;}
.action-btn:hover{filter:brightness(1.2);box-shadow:0 0 20px rgba(0,200,255,0.5);}
</style>
</head>
<body>
<div class="container">
<h2 style="background-color: rgb(207, 217, 220); padding: 10px 20px; border-radius: 15px;">ğ“ğğ“ğ€ğ‹ ğŒğˆğ’ğ“ğ€ğŠğ„ ğğ„ğ‘ğˆğğƒğ„ ğŸ ğ‰ğ®ğ¥ğ¢ - ğŸ‘ğŸ ğğğ¬ğğ¦ğ›ğğ« ğŸğŸğŸğŸ“</h2>

<!-- FORM BONUS GLOBAL -->
<form id="bonusForm" style="margin-bottom:10px;">
  <input type="number" id="globalBonusInput" placeholder="Input Global Bonus (Rp)" required>
  <button type="submit">Simpan Bonus</button>
    <button type="button" id="resetAllBtn" style="background:#ff4d4d;">Reset All</button>
</form>

<!-- FORM TRANSAKSI -->
<form id="txForm">
  <input type="date" id="date" required>
  <input type="text" id="type" placeholder="Transaction Type" required>
  <select id="dc" required>
    <option value="">Debit / Credit</option>
    <option value="Debit">Debit</option>
    <option value="Credit">Credit</option>
  </select>
  <input type="number" id="mistake" placeholder="Mistake (Rp)">
  <button type="submit">Simpan Data</button>
</form>

<table>
  <thead>
    <tr>
      <th>DATE</th>
      <th>TRANSACTION TYPE</th>
      <th>DEBIT / CREDIT</th>
      <th>MISTAKE</th>
      <th>ACTIONS</th>
    </tr>
  </thead>
  <tbody id="dataTable"></tbody>
</table>

<div class="card">
  <div id="bonusCard">Bonus: Rp 0</div>
  <div id="totalMistake">Total Mistakes: Rp 0</div>
</div>

<div class="card" style="margin-top:15px; background:rgba(0,255,150,0.12); box-shadow:0 0 30px rgba(0,255,180,0.6); color:#66ffcc;">
  <div id="totalBersih">Total Bersih: Rp 0</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC77CvszVBIylVbyiIxTM9dUYhC71XT52A",
  authDomain: "brandery-4ee1e.firebaseapp.com",
  databaseURL: "https://brandery-4ee1e-default-rtdb.firebaseio.com",
  projectId: "brandery-4ee1e",
  storageBucket: "brandery-4ee1e.firebasestorage.app",
  messagingSenderId: "34516704976",
  appId: "1:34516704976:web:10120567ff1508311948d5",
  measurementId: "G-QMMZXCCW2X"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const txRef = ref(db, 'transactions');
const bonusRef = ref(db, 'globalBonus');

const txForm = document.getElementById('txForm');
const bonusForm = document.getElementById('bonusForm');
const dataTable = document.getElementById('dataTable');
const bonusCard = document.getElementById('bonusCard');
const totalMistakeCard = document.getElementById('totalMistake');
const totalBersihCard = document.getElementById('totalBersih');

let globalBonus = 0;
let editKey = null;

// ----------------------- FORM BONUS -----------------------
bonusForm.addEventListener('submit', e => {
  e.preventDefault();
  const bonusValue = Number(document.getElementById('globalBonusInput').value) || 0;
  set(bonusRef, bonusValue);
  document.getElementById('globalBonusInput').value = '';
});

// Listener realtime global bonus
onValue(bonusRef, snap => {
  globalBonus = snap.val() || 0;
  bonusCard.textContent = `Bonus: ${formatRupiah(globalBonus)}`;
  updateTotalBersih();
});

// ----------------------- FORM TRANSAKSI -----------------------
txForm.addEventListener('submit', e => {
  e.preventDefault();
  const dataObj = {
    date: document.getElementById('date').value,
    type: document.getElementById('type').value,
    dc: document.getElementById('dc').value,
    mistake: Number(document.getElementById('mistake').value) || 0
  };

  if(editKey){
    set(ref(db, 'transactions/' + editKey), dataObj);
    editKey = null;
  } else {
    push(txRef, dataObj);
  }

  txForm.reset();
});

// ----------------------- LISTENER TRANSAKSI -----------------------
onValue(txRef, snap => {
  dataTable.innerHTML = '';
  let totalMistake = 0;

  snap.forEach(child => {
    const key = child.key;
    const d = child.val();
    const mistakeValue = Number(d.mistake) || 0;
    totalMistake += mistakeValue;

    dataTable.innerHTML += `
      <tr>
        <td>${d.date}</td>
        <td>${d.type}</td>
        <td>${d.dc}</td>
        <td>${formatRupiah(mistakeValue)}</td>
        <td>
          <button class='action-btn' onclick='editData("${key}","${d.date}","${d.type}","${d.dc}","${mistakeValue}")'>Edit</button>
          <button class='action-btn' onclick='deleteData("${key}")'>Delete</button>
        </td>
      </tr>`;
  });

  totalMistakeCard.textContent = `Total Mistakes: ${formatRupiah(totalMistake)}`;
  updateTotalBersih(totalMistake);
});

// ----------------------- FUNSI BANTU -----------------------
function formatRupiah(amount){
  return 'Rp ' + Number(amount).toLocaleString('id-ID');
}

function updateTotalBersih(totalMistake=0){
  // totalBersih = globalBonus - totalMistake
  onValue(txRef, snap => {
    let total = 0;
    snap.forEach(child => {
      total += Number(child.val().mistake) || 0;
    });
    totalBersihCard.textContent = `Total Bersih: ${formatRupiah(globalBonus - total)}`;
  });
}

// ----------------------- EDIT & DELETE -----------------------
window.deleteData = function(key){
  remove(ref(db, 'transactions/' + key));
}

window.editData = function(key,date,type,dc,mistake){
  editKey = key;
  document.getElementById('date').value = date;
  document.getElementById('type').value = type;
  document.getElementById('dc').value = dc;
  document.getElementById('mistake').value = mistake;
}
const resetAllBtn = document.getElementById('resetAllBtn');

resetAllBtn.addEventListener('click', () => {
  if(confirm('Apakah Anda yakin ingin mereset semua data?')) {
    // Hapus semua transaksi
    set(txRef, null);
    // Hapus global bonus
    set(bonusRef, 0);
    // Reset tampilan card
    dataTable.innerHTML = '';
    bonusCard.textContent = 'Bonus: Rp 0';
    totalMistakeCard.textContent = 'Total Mistakes: Rp 0';
    totalBersihCard.textContent = 'Total Bersih: Rp 0';
  }
});
</script>
</div>
</body>
</html>
